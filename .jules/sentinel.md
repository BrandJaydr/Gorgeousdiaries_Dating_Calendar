## 2026-02-25 - Unauthorized Role Escalation Prevention
**Vulnerability:** Overly permissive RLS on the `users` table allowed authenticated users to update their own `role` and `subscription_tier` columns, enabling self-promotion to the `admin` role.
**Learning:** Row Level Security (RLS) in Supabase/PostgreSQL is row-level by default. While you can restrict updates to a row based on ownership, RLS doesn't natively restrict specific columns based on the value change (old vs new) without using more complex `CHECK` expressions or triggers.
**Prevention:** Use a `BEFORE UPDATE` database trigger to enforce column-level security and validate state transitions. Always combine RLS with triggers for "Defense in Depth" when sensitive state transitions are involved. Ensure `SECURITY DEFINER` functions have a fixed `search_path` to prevent hijacking.
